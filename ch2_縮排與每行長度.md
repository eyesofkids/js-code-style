# 縮排與每行長度

## 每行程式碼最多的字數

> Prettier: printWidth, tabWidth, useTabs
> ESLint: max-len, max-lines

每一列程式碼最多的字元數，這當然也包含了 Tab 與空白字元、特殊符號，在所有的風格中都會被設為預設 80 個字元。當然也有程式設計師認為設為 100 或 120 是比較方便閱讀的。不過實務上，程式設計師也很少會寫出這麼長的一段連續的程式碼，因為也很難進行測試除錯，閱讀上也不方便。

但要注意的是中文、日、韓文的每個字的寬度。雖然程式碼只會在字串與註解寫上中日韓文，不過在中日韓文的程式碼註解，如果是 80 字的限制下，不管怎麼樣都會超過一行的，中日韓字元明顯的只能有一半左右的長度而已。

Tab 縮排只有很少數的程式設計師會直接使用 Tab 符號，現在通行的作法是把 Tab 符轉成幾個空白的字元，Prettier 使用了 2 個空白字元，而 ESLint 的預設是 4 個空白字元。使用 2 個空白字元的 Tab 符號轉換可能在複雜與較多的程式碼中會比較理想。

## 字串宣告與最長長度

字串在 JavaScript 裡可以使用三種的宣告符號框住，分別是單引號 single('')、雙引號 double("")與重音符號 backtick(`)。這三種宣告的字串，如果是單行的情況下是一模一樣的結果，並沒有什麼差異，重音符號(`)宣告的字串有特別的用途，下面再詳細說明。

單引號('')、雙引號("")的字串宣告的結果，是一模一樣的，所以產生了不同的撰寫的風格，現在通常的風格會認為在 JavaScript 中的字串，以單引號('')是較為理想的風格，原因是因為 JavaScript 通常會與 HTML 碼搭配混用，HTML 碼中的標記屬性通常使用雙引號，為了減少跳脫字符的使用，所以在 JavaScript 中使用單引號的字串宣告。但這並非百分之百的風格，有些知名的 JS 函式庫像 jQuery，仍然是以雙引號為主要的字串宣告的風格，ESLint 其實預設也是雙引號字串。

我們先整理一下每種常見的風格指引或格式化/檢查工具的建議或是預設的：

- Airbnb - 單引號 single('')
- JavaScript Standard Style - 單引號 single('')
- gjslint (Google Closure Linter) - 單引號 single('')
- Prettier - 雙引號 double("")
- ESLint - 雙引號 double("")
- TypeScript Contributors Coding Guidelines - 雙引號 double("")

為什麼有些風格的建議是使用雙引號？你可能會有疑問。

因為英文的字句中的對主詞的簡寫是很常見的，英文簡寫都會使用到單引號，像下面的範例一樣：

```js
// 雙引號的字串宣告
"It's gettin' better!"

// 單引號的字串宣告
'It\'s gettin\' better!'
```

上面的範例這個就是使用雙引號的最大理由，用了單引號宣告反而會需要作跳脫來讓字串中的單引號符號能跳脫，才能正常的被使用或被看到。

那使用單引號的主要理由呢？其實也是跳脫的問題，經常看到是和HTML碼有關的。像下面的例子：

```js
// 雙引號的字串宣告
let div = "<div class=\"panel\">...</div>"

// 單引號的字串宣告
let div = '<div class="panel">...</div>'
```

不論你要使用單引號或雙引號來宣告字串，有幾個事情是要注意的。

### 使用上的連續一致性(consistent)

如果你選擇了單引號就全部使用單引號，不要再混用雙引號的宣告方式，統一一種撰寫風格。當然像Prettier或ESLint這些工具會協助你作這些事情，不過你還是要有一個正確的使用觀念。

### JSON格式

JSON格式中的字串敘述，只能使用"雙引號"，千萬不要搞錯了。像下面的這個範例一樣：

```json
{
  "in_json": "only_double_quotes"
}
```

### 樣版字串

使用重音符號(`)宣告的字串，是ES6之後的特別的新的宣告方式，稱為"樣版子串"，可以代換掉在字串中的變數或表達式運算的值，例如以下的範例：

```js
// 原本的字串宣告
let str1 = "Hello, " + name + "!"

// es6之後的樣版字串宣告
let str1 = `Hello, ${name}!`

// 原本的字串宣告
let str2 = "Time: " + (12 * 60 * 60)

// es6之後的樣版字串宣告
let str2 = `Time: ${12 * 60 * 60}`
```

當然因為它是新的語法，舊的瀏覽器並不能使用，這一點是要特別注意的，現在在新式的函式庫都開始大量的被採用，尤其是在字串的連接的時候，少用加號(+)來作連接，而是用樣版字串的方式來取代，在撰寫程式碼的時候，可以更容易的來寫，也可以減少出錯的機會。

### 多行字串

不論是雙引號或單引號宣告的字串，其實都是單一行的字串，那出現了兩個問題，第一個是這一行字串就是非常的長，超過了之前說的80個字元的長度，或甚至比螢幕上可以看到的寬度還寬的時候怎麼辦？最簡單就是利用程式碼編輯工具的"自動換行(word wrap)"的功能，可以在編輯區自動換行排版，所有的編輯程式都有這樣的功能，名稱上都很像，你可以到網路上查看看，像下面的幾個常見的編輯程式裡的設定：

- Visual Studio Code - 自動換行 word wrap
- Atom - Soft Wrap
- Sublime - Word Wrap
- WebStorm - Use soft wraps in editor
- Notepad++ - Word wrap

真正的多行字串，樣版字串宣告是可以直接作得到，其它的兩種都只能插入換行的跳脫的字符，像下面這樣的範例：

```js
// 單引號宣告的多行字串
'string text line 1\n' +
'string text line 2'

// 樣版字串
`string text line 1
string text line 2`
```

多行字串也是樣版子串宣告方式的一個特性，或許在將來會經常看到，但原本JS中就很少有用到這種宣告多行字串的方式，所以現在看到的程式碼範例很少見。

## 程式碼分行

我們很少會寫出很長一句的程式碼，最主要的原因是不容易被閱讀，也不容易除錯。有些程式設計師認為對於同一個功能不必要宣告太多的變數，行數能寫得愈短是愈好的，這不一定是絕對正確的，有的時候使用幾個暫存的變數，來讓程式確更好閱讀，也沒有什麼不行的。現在的JS程式碼不會因為多幾個變數或是多幾行後，程式就變得更慢，程式碼擠成一團反而才是不好的寫法。事實上，通常簡潔的寫法反而都是執行最慢的那些寫法，追根究底的話，程式是怎麼執行和運算的，並不一定就是按照你寫的程式碼的樣子直接就運算的，而是會經過預先處理過的。

此外，運算符號的前後要不要加上空白，也是很常見的風格的討論，後面我們再一項項來討論，首先在這章裡針對最重要的，到底什麼時候可以分行，什麼時候不行的最基礎說明。

JS程式語言中的設計，基本上如果是[中缀記號(Infix notation)](https://en.wikipedia.org/wiki/Infix_notation)，或稱為中綴運算符，換一行寫是完全沒問題的，例如最常見的加號(+)與減號(-)，當然要注意這不是指當作數字的正號和負號使用的情況。

像JS中的加號(+)，同時也是字串的連結運算的符號。

像下面的程式碼範例就是合法的利用加號(+)來把很長的程式碼分行：

```js
let str1 = 'string text line 1 is here\n' +
'string text line 2 is here'

let num1 = 3 +
           5
```

運算符是怎麼經過內部的引擎處理過，然後進行運算的，這是很底層的設計，以JS來看至少有下面的幾個過程，以數字的中綴運算符來當範例來研究`1 + 2`的話(出自[Essentials-of-interpretation](https://github.com/DmitrySoshnikov/Essentials-of-interpretation/blob/master/src/lesson-3.js))：

```
Source(原始碼) -> Lexer(掃描/文字預處理) -> Parser(剖析) -> Interpreter(直譯)

"1 + 2" -> ["1", "+", "2"] -> ["+", "1", "2"] -> 3
```

從上面的範例大概可以知道，`1 + 2`是人類用來寫數字加法的記號方式，程式語言的執行引擎並不是用`1 + 2`在執行的，而是 `+(1,2)`，有點像是函式的呼叫執行，實際的執行的情況是怎麼樣的，那是另外的深入課題，並不在我們要討論的範圍。

所以中綴運算符是會先被處理過再運算的一種符號，像上面的加號或減號的範例一樣，都是屬於這種符號的，有左和右兩個參加運算的值時，稱為二元的運算都是這種符號，除了數學運算外，像大於(>)、小於(<)、比較(===)，或是常見的指定運算(=)之類的，都是中綴運算符，另一個是三元運算符(?:)，這些也是很常用在程式碼分行上。

中綴運算符的特性可以從例子裡看得很清楚，像下面幾個寫法都是合法的表達式，雖然它們的結果都一模一樣，但你應該一眼就可以看出，有幾種寫法是很不好的寫法，尤其是分了很多行的寫法，沒有必要不需要這樣浪費空間:

```js
1+2
1 + 2
1 +2

1
+
2

1+
2

1
+2
```

中綴運算符的最後運算結果，也有可能不是你所想像的，像下面的範例因為涉及到另一個遞增運算符的情況，變得非常難一眼看得出它的結果：

```js
// 錯誤的表達式
1+++2
1++ +2
1+ ++2

// 合法的表達式
1+ + +2
1 + + + 2
```

當然上面都是怪異的範例，實務上沒人在這樣寫程式碼的，我們在這裡也不是要討論為什麼會是這樣的結果，這和程式碼是怎麼被預先處理與剖析的規則有關。提出這個範例的目的是為了說明，中綴運算符有空白字元時，在某些情況下，會有不同的預先處理與剖析的結果，最後會影響是不是能運算出值，因此有一個很重要風格最好是要習慣遵守的：

> 在中綴運算符前與後加上空白子元 (eslint: space-infix-ops)

一個來自[Airbnb的JS風格範例](https://github.com/airbnb/javascript#whitespace--infix-ops)說明了怎麼寫程式碼才是好的寫法：

```js
// 不好的寫法
const x=y+5

// 好的寫法
const x = y + 5
```

簡單來說，就是"不要寫程式碼時，有運算符號時全部擠在一堆"，我想這樣能很容易讓各位了解。但是該擠的時候還是要好好的擠在一起，像是`i++`或是`-2`這種符號時，就該要連在一起使用，我想這應該非常簡單的常識。撰寫程式碼是很需要精準度的工作，不要覺得可以隨便寫，只要能達到結果就好，養成好習慣對於未來的開發有非常大的幫助。

最後，談到另一個常見的是逗號(,)，逗號也可以拿來作程式碼的分行使用，最常用的是分隔多個變數值的宣告，陣列裡面的值，或是物件裡的不同的屬性值，不過多個變數用逗號(,)是不太建議使用的，它有不易除錯的問題，不過這裡只是一個範例而已，像下面這些的範例：

```js
let foo = 1, ckk = 1,
    bar = 2

const arr = ["Mike",
             "Ocean", "Paul"]

const obj = {"foo": "bar",
             "baz": "qur"}
```

從上面的範例看起來，逗號(,)後面如果還要接其它的值或變數指定，請加上一個空白，雖然加這個空白並不是有絕對必要，也不會影響程式碼的執行，主要是要讓閱讀性提高的，也就是不要"擠在一堆"的原則。在逗號前面或是後面加上一個空白，通常是加在後面的，這個風格規則是：

> 強制在逗號周邊加上空白(eslint: comma-spacing)

